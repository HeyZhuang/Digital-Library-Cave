# ä¸ªäººçŸ¥è¯†åº“ç³»ç»Ÿ - é«˜å¹¶å‘ä¼˜åŒ–å®æ–½è®¡åˆ’

## ğŸ“‹ ä¼˜åŒ–ç›®æ ‡

- **å½“å‰çŠ¶æ€**: æ”¯æŒå‡ åä¸ªå¹¶å‘ç”¨æˆ·
- **ä¼˜åŒ–ç›®æ ‡**: æ”¯æŒ500-1000ä¸ªå¹¶å‘ç”¨æˆ·
- **å“åº”æ—¶é—´**: å¹³å‡å“åº”æ—¶é—´ < 200ms
- **ç³»ç»Ÿå¯ç”¨æ€§**: 99.9%

## ğŸš€ åˆ†é˜¶æ®µä¼˜åŒ–è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®åº“ä¼˜åŒ– + Redisç¼“å­˜ (1-2å‘¨)

#### ç›®æ ‡
- ä¼˜åŒ–æ•°æ®åº“è¿æ¥æ± é…ç½®
- æ·»åŠ å…³é”®ç´¢å¼•
- å®ç°Redisç¼“å­˜æœºåˆ¶
- æå‡æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½

#### å…·ä½“å®æ–½æ­¥éª¤

##### 1.1 æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
```yaml
# application-prod.yml ä¼˜åŒ–é…ç½®
spring:
  datasource:
    hikari:
      # ç”Ÿäº§ç¯å¢ƒè¿æ¥æ± é…ç½®
      maximum-pool-size: 50          # ä»20å¢åŠ åˆ°50
      minimum-idle: 20               # ä»5å¢åŠ åˆ°20
      connection-timeout: 30000      # è¿æ¥è¶…æ—¶30ç§’
      idle-timeout: 600000          # ç©ºé—²è¶…æ—¶10åˆ†é’Ÿ
      max-lifetime: 1800000         # è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸ30åˆ†é’Ÿ
      leak-detection-threshold: 60000 # è¿æ¥æ³„éœ²æ£€æµ‹
      validation-timeout: 5000       # éªŒè¯è¶…æ—¶
      connection-test-query: SELECT 1
```

##### 1.2 æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
```sql
-- æ‰§è¡Œæ•°æ®åº“ä¼˜åŒ–è„šæœ¬
-- ç”¨æˆ·è¡¨ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_user_username ON sys_user(username);
CREATE INDEX IF NOT EXISTS idx_user_email ON sys_user(email);
CREATE INDEX IF NOT EXISTS idx_user_status ON sys_user(enabled, deleted);

-- æ–‡ç« è¡¨ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_article_status ON sys_article(status, published_at);
CREATE INDEX IF NOT EXISTS idx_article_user_id ON sys_article(user_id);
CREATE INDEX IF NOT EXISTS idx_article_created_at ON sys_article(created_at);

-- è¯„è®ºè¡¨ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_comment_article_id ON sys_comment(article_id);
CREATE INDEX IF NOT EXISTS idx_comment_parent_id ON sys_comment(parent_id);
CREATE INDEX IF NOT EXISTS idx_comment_created_at ON sys_comment(created_at);

-- æ ‡ç­¾è¡¨ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_tag_name ON sys_tag(name);
CREATE INDEX IF NOT EXISTS idx_tag_hot ON sys_tag(hot_count);

-- è®¿é—®ç»Ÿè®¡è¡¨ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_visit_article_id ON sys_visit(article_id);
CREATE INDEX IF NOT EXISTS idx_visit_created_at ON sys_visit(created_at);
```

##### 1.3 Redisç¼“å­˜é…ç½®
```java
// åˆ›å»º RedisConfig.java
@Configuration
@EnableCaching
public class RedisConfig {
    
    @Bean
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(factory);
        
        // ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–
        Jackson2JsonRedisSerializer<Object> serializer = new Jackson2JsonRedisSerializer<>(Object.class);
        ObjectMapper mapper = new ObjectMapper();
        mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        mapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL);
        serializer.setObjectMapper(mapper);
        
        template.setKeySerializer(new StringRedisSerializer());
        template.setValueSerializer(serializer);
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(serializer);
        template.afterPropertiesSet();
        
        return template;
    }
    
    @Bean
    public CacheManager cacheManager(RedisConnectionFactory factory) {
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
            .entryTtl(Duration.ofMinutes(30))  // é»˜è®¤ç¼“å­˜30åˆ†é’Ÿ
            .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(new StringRedisSerializer()))
            .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(new GenericJackson2JsonRedisSerializer()));
        
        return RedisCacheManager.builder(factory)
            .cacheDefaults(config)
            .withCacheConfiguration("user", 
                RedisCacheConfiguration.defaultCacheConfig().entryTtl(Duration.ofHours(2)))
            .withCacheConfiguration("article", 
                RedisCacheConfiguration.defaultCacheConfig().entryTtl(Duration.ofMinutes(10)))
            .withCacheConfiguration("hot", 
                RedisCacheConfiguration.defaultCacheConfig().entryTtl(Duration.ofMinutes(5)))
            .build();
    }
}
```

##### 1.4 ç¼“å­˜æœåŠ¡å®ç°
```java
// åˆ›å»º CacheService.java
@Service
@Slf4j
public class CacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    private static final String USER_CACHE_PREFIX = "user:";
    private static final String ARTICLE_CACHE_PREFIX = "article:";
    private static final String HOT_ARTICLES_KEY = "hot:articles";
    private static final String SEARCH_CACHE_PREFIX = "search:";
    
    /**
     * ç”¨æˆ·ä¿¡æ¯ç¼“å­˜
     */
    @Cacheable(value = "user", key = "#username")
    public User getUserByUsername(String username) {
        return userService.findByUsername(username);
    }
    
    /**
     * æ–‡ç« è¯¦æƒ…ç¼“å­˜
     */
    @Cacheable(value = "article", key = "#articleId")
    public Article getArticleById(Long articleId) {
        return articleService.getById(articleId);
    }
    
    /**
     * çƒ­é—¨æ–‡ç« ç¼“å­˜
     */
    @Cacheable(value = "hot", key = "'articles'")
    public List<Article> getHotArticles() {
        return articleService.getHotArticles();
    }
    
    /**
     * æœç´¢ç»“æœç¼“å­˜
     */
    public List<Article> getSearchResults(String keyword) {
        String cacheKey = SEARCH_CACHE_PREFIX + DigestUtils.md5DigestAsHex(keyword.getBytes());
        List<Article> cached = (List<Article>) redisTemplate.opsForValue().get(cacheKey);
        if (cached != null) {
            return cached;
        }
        
        List<Article> results = searchService.search(keyword);
        redisTemplate.opsForValue().set(cacheKey, results, Duration.ofMinutes(5));
        return results;
    }
    
    /**
     * æ¸…é™¤æ–‡ç« ç¼“å­˜
     */
    @CacheEvict(value = "article", key = "#articleId")
    public void evictArticleCache(Long articleId) {
        log.info("æ¸…é™¤æ–‡ç« ç¼“å­˜: {}", articleId);
    }
}
```

#### ç¬¬ä¸€é˜¶æ®µéªŒæ”¶æ ‡å‡†
- [ ] æ•°æ®åº“è¿æ¥æ± é…ç½®ä¼˜åŒ–å®Œæˆ
- [ ] å…³é”®ç´¢å¼•æ·»åŠ å®Œæˆ
- [ ] Redisç¼“å­˜é…ç½®å®Œæˆ
- [ ] ç¼“å­˜æœåŠ¡å®ç°å®Œæˆ
- [ ] æ€§èƒ½æµ‹è¯•ï¼šå¹¶å‘ç”¨æˆ·æ•°æå‡åˆ°100+

---

### ç¬¬äºŒé˜¶æ®µï¼šå¼‚æ­¥å¤„ç† + å‰ç«¯ä¼˜åŒ– (1-2å‘¨)

#### ç›®æ ‡
- å®ç°å¼‚æ­¥å¤„ç†æœºåˆ¶
- ä¼˜åŒ–å‰ç«¯åŠ è½½æ€§èƒ½
- å®ç°ç»„ä»¶æ‡’åŠ è½½
- ä¼˜åŒ–é™æ€èµ„æºåŠ è½½

#### å…·ä½“å®æ–½æ­¥éª¤

##### 2.1 å¼‚æ­¥é…ç½®
```java
// åˆ›å»º AsyncConfig.java
@Configuration
@EnableAsync
public class AsyncConfig implements AsyncConfigurer {
    
    @Override
    public Executor getAsyncExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(10);
        executor.setMaxPoolSize(50);
        executor.setQueueCapacity(200);
        executor.setKeepAliveSeconds(60);
        executor.setThreadNamePrefix("async-");
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        executor.initialize();
        return executor;
    }
    
    @Override
    public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {
        return new SimpleAsyncUncaughtExceptionHandler();
    }
}
```

##### 2.2 å¼‚æ­¥æœåŠ¡å®ç°
```java
// åˆ›å»º AsyncService.java
@Service
@Slf4j
public class AsyncService {
    
    /**
     * å¼‚æ­¥æ›´æ–°æ–‡ç« è®¿é—®é‡
     */
    @Async
    public void updateArticleViewCount(Long articleId) {
        try {
            articleService.incrementViewCount(articleId);
            log.info("å¼‚æ­¥æ›´æ–°æ–‡ç« è®¿é—®é‡: {}", articleId);
        } catch (Exception e) {
            log.error("æ›´æ–°æ–‡ç« è®¿é—®é‡å¤±è´¥: {}", articleId, e);
        }
    }
    
    /**
     * å¼‚æ­¥å‘é€é‚®ä»¶é€šçŸ¥
     */
    @Async
    public void sendEmailNotification(String to, String subject, String content) {
        try {
            mailService.sendEmail(to, subject, content);
            log.info("å¼‚æ­¥å‘é€é‚®ä»¶æˆåŠŸ: {}", to);
        } catch (Exception e) {
            log.error("å‘é€é‚®ä»¶å¤±è´¥: {}", to, e);
        }
    }
    
    /**
     * å¼‚æ­¥å¤„ç†æ–‡ä»¶ä¸Šä¼ 
     */
    @Async
    public CompletableFuture<String> processFileUpload(MultipartFile file) {
        return CompletableFuture.supplyAsync(() -> {
            try {
                String fileUrl = fileService.uploadFile(file);
                log.info("å¼‚æ­¥å¤„ç†æ–‡ä»¶ä¸Šä¼ æˆåŠŸ: {}", fileUrl);
                return fileUrl;
            } catch (Exception e) {
                log.error("æ–‡ä»¶ä¸Šä¼ å¤„ç†å¤±è´¥", e);
                throw new RuntimeException("æ–‡ä»¶ä¸Šä¼ å¤±è´¥", e);
            }
        });
    }
}
```

##### 2.3 å‰ç«¯è·¯ç”±æ‡’åŠ è½½
```typescript
// ä¿®æ”¹ router/index.ts
import { createRouter, createWebHistory } from 'vue-router'

const routes = [
  {
    path: '/',
    name: 'Home',
    component: () => import('@/views/Home.vue')
  },
  {
    path: '/articles',
    name: 'Articles',
    component: () => import('@/views/Articles.vue')
  },
  {
    path: '/article/:id',
    name: 'ArticleDetail',
    component: () => import('@/views/ArticleDetail.vue')
  },
  {
    path: '/profile',
    name: 'Profile',
    component: () => import('@/views/Profile.vue')
  },
  {
    path: '/admin',
    name: 'Admin',
    component: () => import('@/views/Admin.vue')
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

export default router
```

##### 2.4 ç»„ä»¶æ‡’åŠ è½½ä¼˜åŒ–
```vue
<!-- ä¿®æ”¹ ArticleList.vue -->
<template>
  <div class="article-list">
    <div v-for="article in articles" :key="article.id" class="article-item">
      <img 
        :src="article.coverImage" 
        :alt="article.title"
        loading="lazy"
        class="article-cover"
      />
      <h3>{{ article.title }}</h3>
      <p>{{ article.summary }}</p>
    </div>
  </div>
</template>

<script setup lang="ts">
import { defineAsyncComponent } from 'vue'

// æ‡’åŠ è½½ç»„ä»¶
const LazyCommentList = defineAsyncComponent(() => import('@/components/CommentList.vue'))
const LazyTagList = defineAsyncComponent(() => import('@/components/TagList.vue'))
</script>
```

##### 2.5 Viteæ„å»ºä¼˜åŒ–
```typescript
// ä¿®æ”¹ vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['vue', 'vue-router', 'pinia'],
          ui: ['@headlessui/vue', '@heroicons/vue'],
          utils: ['axios', 'marked', 'highlight.js']
        }
      }
    },
    chunkSizeWarningLimit: 1000
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8181',
        changeOrigin: true
      }
    }
  }
})
```

#### ç¬¬äºŒé˜¶æ®µéªŒæ”¶æ ‡å‡†
- [ ] å¼‚æ­¥å¤„ç†æœºåˆ¶å®ç°å®Œæˆ
- [ ] å‰ç«¯è·¯ç”±æ‡’åŠ è½½å®Œæˆ
- [ ] ç»„ä»¶æ‡’åŠ è½½å®Œæˆ
- [ ] æ„å»ºä¼˜åŒ–å®Œæˆ
- [ ] æ€§èƒ½æµ‹è¯•ï¼šå¹¶å‘ç”¨æˆ·æ•°æå‡åˆ°200+

---

### ç¬¬ä¸‰é˜¶æ®µï¼šæœåŠ¡å™¨é…ç½® + ç›‘æ§å‘Šè­¦ (1å‘¨)

#### ç›®æ ‡
- ä¼˜åŒ–æœåŠ¡å™¨é…ç½®
- å®ç°åº”ç”¨ç›‘æ§
- é…ç½®æ€§èƒ½å‘Šè­¦
- ä¼˜åŒ–é™æ€èµ„æºå¤„ç†

#### å…·ä½“å®æ–½æ­¥éª¤

##### 3.1 Nginxé…ç½®ä¼˜åŒ–
```nginx
# nginx.conf
upstream backend {
    server 127.0.0.1:8181;
    server 127.0.0.1:8182;
    server 127.0.0.1:8183;
}

server {
    listen 80;
    server_name your-domain.com;
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        add_header X-Content-Type-Options nosniff;
    }
    
    # APIä»£ç†
    location /api/ {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
        
        # ç¼“å†²è®¾ç½®
        proxy_buffering on;
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
    }
    
    # å‰ç«¯è·¯ç”±
    location / {
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
    
    # å®‰å…¨å¤´
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
}
```

##### 3.2 JVMä¼˜åŒ–é…ç½®
```bash
# ä¿®æ”¹ start.sh
#!/bin/bash

# JVMä¼˜åŒ–å‚æ•°
JVM_OPTS="-Xms2g -Xmx4g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=200 \
     -XX:+UseStringDeduplication \
     -XX:+HeapDumpOnOutOfMemoryError \
     -XX:HeapDumpPath=/logs/heapdump.hprof \
     -XX:+PrintGCDetails \
     -XX:+PrintGCTimeStamps \
     -Xloggc:/logs/gc.log \
     -Dspring.profiles.active=prod"

# å¯åŠ¨åº”ç”¨
java $JVM_OPTS -jar spring-knowledge.jar
```

##### 3.3 åº”ç”¨ç›‘æ§é…ç½®
```yaml
# application.yml æ·»åŠ ç›‘æ§é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true
  server:
    port: 8081
```

##### 3.4 æ€§èƒ½ç›‘æ§å®ç°
```java
// åˆ›å»º PerformanceMonitor.java
@Component
@Slf4j
public class PerformanceMonitor {
    
    private final MeterRegistry meterRegistry;
    
    public PerformanceMonitor(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
    }
    
    @EventListener
    public void handleRequestEvent(RequestEvent event) {
        Timer.Sample sample = Timer.start(meterRegistry);
        
        // è®°å½•è¯·æ±‚å¤„ç†æ—¶é—´
        sample.stop(Timer.builder("http.server.requests")
            .tag("uri", event.getUri())
            .tag("method", event.getMethod())
            .register(meterRegistry));
    }
    
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    public void logPerformanceMetrics() {
        long totalMemory = Runtime.getRuntime().totalMemory();
        long freeMemory = Runtime.getRuntime().freeMemory();
        long usedMemory = totalMemory - freeMemory;
        
        log.info("å†…å­˜ä½¿ç”¨æƒ…å†µ - æ€»å†…å­˜: {}MB, å·²ç”¨å†…å­˜: {}MB, ç©ºé—²å†…å­˜: {}MB", 
            totalMemory / 1024 / 1024,
            usedMemory / 1024 / 1024,
            freeMemory / 1024 / 1024);
    }
}
```

#### ç¬¬ä¸‰é˜¶æ®µéªŒæ”¶æ ‡å‡†
- [ ] Nginxé…ç½®ä¼˜åŒ–å®Œæˆ
- [ ] JVMå‚æ•°ä¼˜åŒ–å®Œæˆ
- [ ] åº”ç”¨ç›‘æ§é…ç½®å®Œæˆ
- [ ] æ€§èƒ½ç›‘æ§å®ç°å®Œæˆ
- [ ] æ€§èƒ½æµ‹è¯•ï¼šå¹¶å‘ç”¨æˆ·æ•°æå‡åˆ°300+

---

### ç¬¬å››é˜¶æ®µï¼šè¯»å†™åˆ†ç¦» + è´Ÿè½½å‡è¡¡ (1-2å‘¨)

#### ç›®æ ‡
- å®ç°æ•°æ®åº“è¯»å†™åˆ†ç¦»
- é…ç½®è´Ÿè½½å‡è¡¡
- å®ç°æœåŠ¡é«˜å¯ç”¨
- æœ€ç»ˆæ€§èƒ½ä¼˜åŒ–

#### å…·ä½“å®æ–½æ­¥éª¤

##### 4.1 æ•°æ®åº“è¯»å†™åˆ†ç¦»é…ç½®
```java
// åˆ›å»º DataSourceConfig.java
@Configuration
public class DataSourceConfig {
    
    @Bean
    @Primary
    @ConfigurationProperties("spring.datasource.master")
    public DataSource masterDataSource() {
        return DataSourceBuilder.create().build();
    }
    
    @Bean
    @ConfigurationProperties("spring.datasource.slave")
    public DataSource slaveDataSource() {
        return DataSourceBuilder.create().build();
    }
    
    @Bean
    public DataSource dynamicDataSource() {
        DynamicRoutingDataSource dynamicDataSource = new DynamicRoutingDataSource();
        Map<Object, Object> dataSourceMap = new HashMap<>();
        dataSourceMap.put("master", masterDataSource());
        dataSourceMap.put("slave", slaveDataSource());
        
        dynamicDataSource.setTargetDataSources(dataSourceMap);
        dynamicDataSource.setDefaultTargetDataSource(masterDataSource());
        
        return dynamicDataSource;
    }
}
```

##### 4.2 æ•°æ®æºé…ç½®
```yaml
# application-prod.yml æ·»åŠ å¤šæ•°æ®æºé…ç½®
spring:
  datasource:
    master:
      type: com.zaxxer.hikari.HikariDataSource
      driver-class-name: com.mysql.cj.jdbc.Driver
      url: jdbc:mysql://140.143.155.164:3306/deepseek_doctor?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
      username: deepseek_doctor
      password: irynfFasGWGykf5x
      hikari:
        maximum-pool-size: 30
        minimum-idle: 10
    slave:
      type: com.zaxxer.hikari.HikariDataSource
      driver-class-name: com.mysql.cj.jdbc.Driver
      url: jdbc:mysql://140.143.155.164:3306/deepseek_doctor_slave?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
      username: deepseek_doctor
      password: irynfFasGWGykf5x
      hikari:
        maximum-pool-size: 20
        minimum-idle: 5
```

##### 4.3 è´Ÿè½½å‡è¡¡é…ç½®
```nginx
# nginx.conf è´Ÿè½½å‡è¡¡é…ç½®
upstream backend {
    # ä¸»æœåŠ¡å™¨
    server 127.0.0.1:8181 weight=3;
    # å¤‡ç”¨æœåŠ¡å™¨
    server 127.0.0.1:8182 weight=2;
    server 127.0.0.1:8183 weight=1;
    
    # å¥åº·æ£€æŸ¥
    keepalive 32;
}

server {
    listen 80;
    server_name your-domain.com;
    
    # è´Ÿè½½å‡è¡¡é…ç½®
    location /api/ {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¿æ¥ä¿æŒ
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }
}
```

##### 4.4 æœåŠ¡é«˜å¯ç”¨é…ç½®
```yaml
# docker-compose.yml å¤šå®ä¾‹éƒ¨ç½²
version: '3.8'
services:
  app1:
    build: .
    ports:
      - "8181:8181"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
    depends_on:
      - mysql
      - redis
      - elasticsearch
  
  app2:
    build: .
    ports:
      - "8182:8181"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
    depends_on:
      - mysql
      - redis
      - elasticsearch
  
  app3:
    build: .
    ports:
      - "8183:8181"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
    depends_on:
      - mysql
      - redis
      - elasticsearch
  
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - app1
      - app2
      - app3
```

#### ç¬¬å››é˜¶æ®µéªŒæ”¶æ ‡å‡†
- [ ] æ•°æ®åº“è¯»å†™åˆ†ç¦»å®ç°å®Œæˆ
- [ ] è´Ÿè½½å‡è¡¡é…ç½®å®Œæˆ
- [ ] æœåŠ¡é«˜å¯ç”¨é…ç½®å®Œæˆ
- [ ] æœ€ç»ˆæ€§èƒ½æµ‹è¯•å®Œæˆ
- [ ] æ€§èƒ½æµ‹è¯•ï¼šå¹¶å‘ç”¨æˆ·æ•°è¾¾åˆ°500+

---

## ğŸ“Š æ€§èƒ½æµ‹è¯•è®¡åˆ’

### æµ‹è¯•å·¥å…·
- **Apache Bench (ab)**: åŸºç¡€å‹åŠ›æµ‹è¯•
- **JMeter**: å¤æ‚åœºæ™¯æµ‹è¯•
- **Gatling**: é«˜å¹¶å‘æµ‹è¯•

### æµ‹è¯•åœºæ™¯
```bash
# åŸºç¡€å‹åŠ›æµ‹è¯•
ab -n 1000 -c 100 http://your-domain.com/api/articles

# ç™»å½•æµ‹è¯•
ab -n 500 -c 50 -p login.json -T application/json http://your-domain.com/api/auth/login

# æœç´¢æµ‹è¯•
ab -n 800 -c 80 "http://your-domain.com/api/search?keyword=test"
```

### æ€§èƒ½æŒ‡æ ‡
- **å“åº”æ—¶é—´**: å¹³å‡ < 200msï¼Œ95% < 500ms
- **ååé‡**: 1000+ QPS
- **å¹¶å‘ç”¨æˆ·**: 500+ ç”¨æˆ·
- **é”™è¯¯ç‡**: < 1%

## ğŸ”§ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### ç¬¬ä¸€é˜¶æ®µæ£€æŸ¥
- [ ] RedisæœåŠ¡å¯åŠ¨æ­£å¸¸
- [ ] æ•°æ®åº“ç´¢å¼•åˆ›å»ºæˆåŠŸ
- [ ] ç¼“å­˜æœåŠ¡æ­£å¸¸å·¥ä½œ
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡

### ç¬¬äºŒé˜¶æ®µæ£€æŸ¥
- [ ] å¼‚æ­¥ä»»åŠ¡æ­£å¸¸æ‰§è¡Œ
- [ ] å‰ç«¯æ‡’åŠ è½½ç”Ÿæ•ˆ
- [ ] æ„å»ºä¼˜åŒ–å®Œæˆ
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡

### ç¬¬ä¸‰é˜¶æ®µæ£€æŸ¥
- [ ] Nginxé…ç½®ç”Ÿæ•ˆ
- [ ] JVMå‚æ•°ç”Ÿæ•ˆ
- [ ] ç›‘æ§æ•°æ®æ­£å¸¸
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡

### ç¬¬å››é˜¶æ®µæ£€æŸ¥
- [ ] è¯»å†™åˆ†ç¦»æ­£å¸¸å·¥ä½œ
- [ ] è´Ÿè½½å‡è¡¡ç”Ÿæ•ˆ
- [ ] é«˜å¯ç”¨é…ç½®å®Œæˆ
- [ ] æœ€ç»ˆæ€§èƒ½æµ‹è¯•é€šè¿‡

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### æ€§èƒ½æå‡
- **å¹¶å‘ç”¨æˆ·æ•°**: ä»å‡ åä¸ªæå‡åˆ°500+
- **å“åº”æ—¶é—´**: å¹³å‡å“åº”æ—¶é—´é™ä½50%
- **ç³»ç»Ÿååé‡**: æå‡3-5å€
- **ç³»ç»Ÿç¨³å®šæ€§**: 99.9%å¯ç”¨æ€§

### æˆæœ¬æ•ˆç›Š
- **å¼€å‘æˆæœ¬**: åˆ†é˜¶æ®µå®æ–½ï¼Œé£é™©å¯æ§
- **è¿ç»´æˆæœ¬**: è‡ªåŠ¨åŒ–ç›‘æ§ï¼Œé™ä½äººå·¥æˆæœ¬
- **æ‰©å±•æ€§**: ä¸ºæœªæ¥ä¸šåŠ¡å¢é•¿åšå¥½å‡†å¤‡

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **åˆ†é˜¶æ®µå®æ–½**: æ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œå……åˆ†æµ‹è¯•
2. **æ•°æ®å¤‡ä»½**: æ¯æ¬¡ä¿®æ”¹å‰å¤‡ä»½é‡è¦æ•°æ®
3. **ç›‘æ§å‘Šè­¦**: å®æ—¶ç›‘æ§ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
4. **å›æ»šè®¡åˆ’**: å‡†å¤‡å¿«é€Ÿå›æ»šæ–¹æ¡ˆ
5. **æ–‡æ¡£è®°å½•**: è¯¦ç»†è®°å½•æ¯æ¬¡ä¼˜åŒ–è¿‡ç¨‹å’Œæ•ˆæœ

---

**é¢„è®¡æ€»æ—¶é—´**: 4-7å‘¨
**é¢„æœŸæ•ˆæœ**: æ”¯æŒ500+å¹¶å‘ç”¨æˆ·ï¼Œå“åº”æ—¶é—´ < 200ms
**é£é™©ç­‰çº§**: ä¸­ç­‰ï¼ˆåˆ†é˜¶æ®µå®æ–½é™ä½é£é™©ï¼‰ 